<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Stocks</title>
</head>
<body>
    <h1>üîç Search Stock Symbol</h1>

    <form method="POST" action="/search_stock">
        <input type="text" name="keyword" placeholder="Enter stock symbol (e.g., AAPL)" required>
        <button type="submit">Search</button>
    </form>

    <ul>
    {% for row in results %}
        <li>
            <strong>{{ row[0] }}</strong> ‚Äî {{ row[1] or "No company name" }}, Current price: {{ row[2] or "Unknown" }}
            <button onclick="addToWatchlist('{{ row[0] }}')">Add to Watchlist</button>
            <button onclick="addToPortfolio('{{ row[0] }}', '{{ row[2] or 0 }}')">Add to Portfolio</button>
        </li>
    {% endfor %}
    </ul>

    <script>
        function addToWatchlist(symbol) {
            const watchlistname = prompt("Enter the name of the watchlist (case-sensitive):");
            if (!watchlistname) return;

            const quantity = prompt("Enter quantity to add (default = 1):", "1");
            if (!quantity || isNaN(quantity) || quantity <= 0) {
                return alert("Please enter a valid number greater than 0.");
            }

            fetch('/add_to_watchlist', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    symbol: symbol,
                    watchlistname: watchlistname,
                    quantity: parseInt(quantity)  // ‚úÖ NOW you‚Äôre sending it
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload(); // üîÑ Refresh the page
            })
            .catch(error => console.error('Error:', error));
        }

        function addToPortfolio(symbol, defaultPrice) {
            const pname = prompt("Enter the portfolio name (case-sensitive):");
            if (!pname) return;

            const qty = prompt("Enter the purchase quantity:", "1");
            if (!qty || isNaN(qty) || qty <= 0) return alert("Invalid quantity.");

            const price = prompt("Enter the buy price (default to current price)", defaultPrice);
            if (!price || isNaN(price)) return alert("Invalid price.");

            fetch('/add_to_portfolio', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    symbol: symbol,
                    pname: pname,
                    qty: parseInt(qty),
                    price: parseFloat(price)
                })
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch(error => console.error('Error:', error));
        }
    </script>

    <a href="/welcome">‚Üê Back to Home</a>
</body>
</html>
