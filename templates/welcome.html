<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>欢迎页面</title>
    <script>
        function sendFriendRequest(receiverId) {
            fetch('/send_friend_request', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ receiver_id: receiverId })
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch(error => console.error('Error:', error));
        }

        function respondFriendRequest(senderId, action) {
            fetch('/respond_friend_request', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sender_id: senderId, action: action })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload();
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>欢迎, {{ current_user }}！</h1>
    <a href="/logout" style="color: red; font-weight: bold;">登出</a>

    <h2>所有用户：</h2>
    <ul>
        {% for user in users %}
            {% if user[0] != current_user_id %}
            <li>
                {{ user[1] }}
                <button onclick="sendFriendRequest({{ user[0] }})">发送好友请求</button>
            </li>
            {% endif %}
        {% endfor %}
    </ul>

    <h2>收到的好友请求：</h2>
    <ul>
        {% for request in friend_requests %}
        <li>
            {{ request[1] }} 发送了好友请求
            <button onclick="respondFriendRequest({{ request[0] }}, 'accept')">接受</button>
            <button onclick="respondFriendRequest({{ request[0] }}, 'reject')">拒绝</button>
        </li>
        {% endfor %}
    </ul>

    <h2>你的好友列表：</h2>
    <ul>
        {% for friend in friends %}
        <li>{{ friend[1] }}</li>
        {% else %}
        <li>你还没有好友。</li>
        {% endfor %}
    </ul>
</body>
</html>
