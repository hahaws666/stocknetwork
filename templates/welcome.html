<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Welcome Page</title>
    <script>
        function sendFriendRequest(receiverId) {
            fetch('/send_friend_request', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user2_id: receiverId })
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch(error => console.error('Error:', error));
        }

        function respondFriendRequest(senderId, action) {
            fetch('/respond_friend_request', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user1_id: senderId, action: action })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload();
            })
            .catch(error => console.error('Error:', error));
        }

        function deleteFriend(friendId) {
            if (!confirm("Are you sure you want to delete this friend?")) return;

            fetch('/delete_friend', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ friend_id: friendId })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload();
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>Welcome, {{ current_user }}!</h1>
    <a href="/logout" style="color: red; font-weight: bold;">Log out</a>

    <h2>All Users:</h2>
    <ul>
        {% for user in users %}
            {% if user[0] != current_user_id %}
            <li>
                {{ user[1] }}
                <button onclick="sendFriendRequest({{ user[0] }})">Send Friend Request</button>
            </li>
            {% endif %}
        {% endfor %}
    </ul>

    <h2>Received Friend Requests:</h2>
    <ul>
        {% for request in friend_requests %}
        <li>
            {{ request[1] }} sent a friend request
            <button onclick="respondFriendRequest({{ request[0] }}, 'accept')">Accept</button>
            <button onclick="respondFriendRequest({{ request[0] }}, 'reject')">Reject</button>
        </li>
        {% endfor %}
    </ul>

    <h2>Your Friend List:</h2>
    <ul>
        {% for friend in friends %}
        <li>
            {{ friend[1] }}
            <button onclick="deleteFriend({{ friend[0] }})" style="color: red;">Delete</button>
        </li>
        {% else %}
        <li>You have no friends yet.</li>
        {% endfor %}
    </ul>

    <a href="/search_stock">ğŸ” Search Stocks</a> |
    <a href="/portfolio_watchlist">ğŸ“ Portfolio & Watchlist</a> |
    <a href="/watchlist_dashboard">ğŸ“Š Watchlist Dashboard</a>

    <h2>ğŸ—‚ï¸ Accessible Public Stocklists</h2>
    <ul>
      {% for owner_id, owner_name, list_name in public_watchlists %}
        <li>
          "{{ owner_name }}"'s "{{ list_name }}"
          <a href="{{ url_for('view_watchlist', owner_id=owner_id, watchlist_name=list_name) }}">View Comments</a>
        </li>
      {% else %}
        <li>No public stocklists available.</li>
      {% endfor %}
    </ul>
    <h2>ğŸŒ All Public Stocklists</h2>
    <ul>
        {% for owner_id, owner_name, list_name in public_stocklists %}
            <li>
                "{{ owner_name }}"'s "{{ list_name }}"
                <a href="{{ url_for('view_watchlist', owner_id=owner_id, watchlist_name=list_name) }}">View Comments</a>
                |
                <a href="{{ url_for('watchlist_performance', owner_id=owner_id, watchlist_name=list_name) }}">View Performance</a>
            </li>
        {% else %}
            <li>No public stocklists available</li>
        {% endfor %}
    </ul>
</body>
</html>
